

# Display swish times in GMT

$ENV{TZ} = 'UTC';


# Stas added tree display - Apr 15, 2002
# syntax (amount of spaces doesn't matter):
# indent path title
#


my $items = <<ITEMS;
    0 outstanding Technologie Extraordinaire
    0 download    Download
    0 docs        Documentation
    1   docs/1.0 mod_perl 1.0 Docs
    2     docs/1.0/guide Guide
    2     docs/1.0/win32 Win32
    2     docs/1.0/api   API
    1   docs/2.0 mod_perl 2.0 Docs
    2     docs/2.0/user  User
    2     docs/2.0/devel Developer
    2     docs/2.0/api   API
    1   docs/general      General Docs
    1   docs/tutorials    Tutorials
    1   docs/offsite      OffSite Docs
    0 help       Getting Help
    0 products   Products
    0 contribute Contribute
ITEMS

my @items_flat = split /\n/, $items, ;

my @items = ();
my $parent;
my $cur_indent = 0;
for my $item (@items_flat) {
    $item = '' unless defined $item;
    my ($indent, $path, $title);
    if ($item =~ m|^\s*(\d+)\s+(\S+)\s+(.*)$|) {
        ($indent, $path, $title) = ($1, $2, $3)
    }
    else {
        warn "couldn't parse '$item'";
        next;
    }

    my $node = {
        label  => $title,
        value  => $path,
        parent => $parent,
    };

    my $diff = $indent - $cur_indent;
    #print "$indent, $cur_indent, $path, $title\n";
    if ($diff < 1 ) {
        for (0..abs($diff)) {
            $parent = $parent->{parent};
            $cur_indent--;
        }
    }

    if ($indent == 0) {
        push @items, $node;
        $parent = $items[-1];
        $cur_indent = 0;
        next;
    }

    if ($diff > 1) {
        $cur_indent++;
        $parent = @{ $parent->{subs} }[-1];
        push @{ $parent->{subs} }, $node;
    }
    else { # $indent - $cur_indent = 1
        push @{ $parent->{subs} }, $node;
    }

}

#use Data::Dumper;
#print Dumper \@items;


return {
    title           => 'Search mod_perl Site',
    prepend_path    => '../',  # search results are shown one level down

    display_props   => [qw/swishlastmodified swishdocsize swishdocpath pagelen/],

    page_size       => 10,

    template        => {
            package         => 'TemplateToolkit',
            file            => 'search.tt',
            options         => {
                INCLUDE_PATH    => '.',
            },
    },


    select_by_meta  => {
        #method      => 'radio_group',  # pick: radio_group, popup_menu, or checkbox_group
        method      => 'checkbox_group',
        #method      => 'popup_menu',
        columns     => 6,
        metaname    => 'section',     # Can't be a metaname used elsewhere!

        # These are the words (phrases) used for limiting searches to areas of the document tree
        values      => [qw(
            docs
            docs/1.0/guide
            docs/2.0
            maillist
            stories
            support
        )],

        labels  => {
            docs        => 'mod_perl Documentation',
            'docs/1.0/guide'    => 'The Guide',
            'docs/2.0'  => '2.0 Docs',
            maillist    => 'Mailing Lists',
            products    => 'mod_perl Based Software',
            stories     => 'Sucess Stories',
            support     => 'Support Options',
        },

        description => 'Limit search to these areas: ',

        # This is the tree structure of selects
        items       => \@items,
    },
    
};
